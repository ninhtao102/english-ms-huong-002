<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden">
  <mat-drawer-container class="flex-auto h-full">
    <!-- Drawer -->
    <mat-drawer class="w-90 dark:bg-gray-900" [autoFocus]="false" [mode]="drawerMode" [opened]="drawerOpened" #matDrawer>
      <div class="flex flex-col items-start p-8 border-b">
        <!-- Back to homeworks -->
        <a class="inline-flex items-center leading-6 text-primary hover:underline" [routerLink]="['..']">
          <span class="inline-flex items-center">
            <mat-icon class="icon-size-5 text-current" [svgIcon]="'heroicons_solid:arrow-sm-left'"></mat-icon>
            <span class="ml-1.5 font-medium leading-5">{{ 'homeworks.label.backtoHomeworks' | transloco}}</span>
          </span>
        </a>

        <!-- Homework title & description -->
        <div class="mt-3 text-2xl font-semibold">{{ detail?.title }}</div>
        <div class="text-secondary">{{ detail?.description }}</div>

        <!-- Homework time -->
        <div class="mt-6 flex items-center leading-5 text-md text-secondary">
          <mat-icon class="icon-size-5 text-hint" [svgIcon]="'heroicons_solid:clock'"></mat-icon>
          <div class="ml-1.5">{{ 'homeworks.label.dueDate' | transloco }} {{ detail?.dueDate | date: 'dd/MM/yyyy' }}</div>
        </div>
      </div>

      <!-- Steps -->
      <div class="py-2 px-8">
        <ol>
          <ng-container *ngFor="let step of detail?.questions; let idx = index; let last = last">
            <li class="relative group py-6" [class.current-step]="step.orderIndex === currentStep">
              <ng-container *ngIf="!last">
                <div class="absolute top-6 left-4 w-0.5 h-full -ml-px"
                  [ngClass]="{'bg-primary': step.completed, 'bg-gray-300 dark:bg-gray-600': !step.completed}">
                </div>
              </ng-container>

              <div class="relative flex items-start cursor-pointer" (click)="goToStep(step.orderIndex)">
                <div class="flex flex-0 items-center justify-center w-8 h-8 rounded-full ring-2 ring-inset ring-transparent bg-card dark:bg-default"
                  [ngClass]="{'bg-primary dark:bg-primary text-on-primary group-hover:bg-primary-800': step.completed,
                              'ring-primary': step.orderIndex === currentStep && !step.completed,
                              'ring-gray-300 dark:ring-gray-600 group-hover:ring-gray-400': step.orderIndex != currentStep && !step.completed}">
                  <ng-container *ngIf="step.completed">
                    <mat-icon class="icon-size-5 text-current" [svgIcon]="'heroicons_solid:check'"></mat-icon>
                  </ng-container>

                  <ng-container *ngIf="step.orderIndex === currentStep">
                    <div class="text-md font-semibold text-primary dark:text-primary-500">{{ step.orderIndex + 1 }}</div>
                  </ng-container>

                  <ng-container *ngIf="step.orderIndex != currentStep && !step.completed">
                    <div class="text-md font-semibold text-hint group-hover:text-secondary">{{ step.orderIndex + 1 }}</div>
                  </ng-container>
                </div>

                <div class="ml-4">
                  <div class="font-medium leading-4">{{ step?.questionText }}</div>
                  <div class="mt-1.5 text-md leading-4 text-secondary">{{ step.readingPassage }}</div>
                </div>
              </div>
            </li>
          </ng-container>
        </ol>
      </div>
    </mat-drawer>

    <!-- Drawer content -->
    <mat-drawer-content class="flex flex-col overflow-hidden">
      <!-- Header -->
      <div class="lg:hidden flex flex-0 items-center py-2 pl-4 pr-6 sm:py-4 md:pl-6 md:pr-8 border-b lg:border-b-0 bg-card dark:bg-transparent">
        <!-- Title & Actions -->
        <button mat-icon-button [routerLink]="['..']">
          <mat-icon [svgIcon]="'heroicons_outline:arrow-sm-left'"></mat-icon>
        </button>

        <h2 class="ml-2.5 text-md sm:text-xl font-medium tracking-tight truncate">
          {{ detail?.title }}
        </h2>
      </div>
      <mat-progress-bar class="hidden lg:block flex-0 h-0.5 w-full" [value]="100 * (currentStep + 1) / detail?.totalSteps"></mat-progress-bar>

      <!-- Main -->
      <div class="flex-auto overflow-y-auto" cdkScrollable>
        <!-- Steps -->
        <mat-tab-group class="fuse-mat-no-header" [animationDuration]="'200'" #homeworkSteps>
          <ng-container *ngFor="let question of detail?.questions">
            <mat-tab>
              <ng-template matTabContent>
                <div class="prose prose-sm max-w-3xl mx-auto sm:my-2 lg:mt-4 p-6 sm:p-10 sm:py-12 rounded-2xl shadow overflow-hidden bg-card"
                  style="min-height: 70vh;">
                  <!-- Title & Reading passage -->
                  <div class="flex flex-wrap font-bold" *ngIf="question?.questionText" [innerHTML]="question?.questionText | dotPatternReplace"></div>
                  <div class="readingPassage flex flex-wrap" *ngIf="question?.readingPassage" [innerHTML]="question?.readingPassage | dotPatternReplace"></div>

                  <!-- Essay -->
                  <ng-container *ngIf="question?.questionType === 6">
                    <hr class="w-full border-b border-dashed my-6 mb-0">
                    <hr class="w-full border-b border-dashed my-6 mb-0">
                    <hr class="w-full border-b border-dashed my-6 mb-0">
                    <hr class="w-full border-b border-dashed my-6 mb-0">
                    <hr class="w-full border-b border-dashed my-6 mb-0">
                  </ng-container>

                  <!-- Child question -->
                  <ng-container *ngFor="let child of question?.questions; let i = index">
                    <div class="flex flex-wrap font-semibold">
                      <span *ngIf="child.questionType !== 0" class="">Question {{ i + 1 }}:&nbsp;</span>
                      <div class="questionText flex flex-wrap gap-1" *ngIf="child?.questionText" [innerHTML]="child?.questionText | dotPatternReplace"></div>
                    </div>

                    <div class="readingPassage flex flex-wrap" *ngIf="child?.readingPassage" [innerHTML]="child?.readingPassage | dotPatternReplace"></div>

                    <!-- Rewrite -->
                    <ng-container *ngIf="child?.questionType === 5">
                      <div class="w-full flex flex-wrap gap-1">
                        &rarr;
                        <div class="" [innerHTML]="child?.suggestAnswer | dotPatternReplace"></div>
                        <hr class="w-1/2 border-b border-dashed my-6 mb-0">
                      </div>
                    </ng-container>

                    <!-- Fill in the blank -->
                    <ng-container *ngIf="child?.questionType === 4">
                      <div class="w-full flex flex-wrap gap-1">
                        <div class="" [innerHTML]="child?.suggestAnswer | dotPatternReplace"></div>
                      </div>
                    </ng-container>

                    <!-- Single choice, multiple choice, reading comprehension -->
                    <ng-container *ngIf="child?.questionType > 0 && child?.questionType < 4">
                      <div class="flex flex-wrap flex-row gap-2" *ngFor="let answer of child?.answerDtos">
                        <ng-container *ngIf="!answer.isCorrect">
                          <div class="flex items-center justify-center w-5 h-5">
                            <div class="w-4 h-4 rounded-full border-2"></div>
                          </div>
                        </ng-container>
                        <ng-container *ngIf="answer?.isCorrect">
                          <mat-icon class="text-hint icon-size-5" [svgIcon]="'heroicons_solid:check-circle'"></mat-icon>
                        </ng-container>
                        <div class="answerText ml-1.5 leading-5">
                          {{ answer?.answerText }}
                        </div>
                      </div>
                    </ng-container>
                  </ng-container>
                </div>
              </ng-template>
            </mat-tab>
          </ng-container>
        </mat-tab-group>

        <!-- Navigation - Desktop -->
        <div class="z-10 sticky hidden lg:flex bottom-4 p-4">
          <div class="flex items-center justify-center mx-auto p-2 rounded-full shadow-lg bg-primary">
            <button class="flex-0" mat-flat-button [color]="'primary'" (click)="goToPreviousQuestion()">
              <mat-icon class="mr-2" [svgIcon]="'heroicons_outline:arrow-narrow-left'"></mat-icon>
              <span class="mr-1">Prev</span>
            </button>

            <div class="flex items-center justify-center mx-2.5 font-medium leading-5 text-on-primary">
              <span>{{ currentStep + 1 }}</span>
              <span class="mx-0.5 text-hint">/</span>
              <span>{{ detail?.totalSteps }}</span>
            </div>

            <button class="flex-0" mat-flat-button [color]="'primary'" (click)="goToNextQuestion()">
              <span class="ml-1">Next</span>
              <mat-icon class="ml-2" [svgIcon]="'heroicons_outline:arrow-narrow-right'"></mat-icon>
            </button>
          </div>
        </div>
      </div>

      <!-- Progress & Navigation - Mobile -->
      <div class="lg:hidden flex items-center p-4 border-t bg-card">
        <button mat-icon-button (click)="matDrawer.toggle()">
          <mat-icon [svgIcon]="'heroicons_outline:view-list'"></mat-icon>
        </button>
        <div class="flex items-center justify-center ml-1 lg:ml-2 font-medium leading-5">
          <span>{{ currentStep + 1 }}</span>
          <span class="mx-0.5 text-hint">/</span>
          <span>{{ detail?.totalSteps }}</span>
        </div>

        <mat-progress-bar class="flex-auto ml-6 rounded-full" [value]="100 * (currentStep + 1) / detail?.totalSteps"></mat-progress-bar>
        <button class="ml-4" mat-icon-button (click)="goToPreviousQuestion()">
          <mat-icon [svgIcon]="'heroicons_outline:arrow-narrow-left'"></mat-icon>
        </button>
        <button class="ml-0.5" mat-icon-button (click)="goToNextQuestion()">
          <mat-icon [svgIcon]="'heroicons_outline:arrow-narrow-right'"></mat-icon>
        </button>
      </div>
    </mat-drawer-content>
  </mat-drawer-container>
</div>
